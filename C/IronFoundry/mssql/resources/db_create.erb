-- vim:syntax=off:ts=2:sw=2

:on error exit
:out <%= sqlcmd_output_file %>
:error <%= sqlcmd_error_output_file %>

:setvar DATA_DIR "<%= base_dir %>\sqldata"
:setvar DB_NAME <%= db_name %>

USE [master]
GO

EXEC sys.xp_create_subdir '$(DATA_DIR)'
GO

CREATE DATABASE [$(DB_NAME)] ON PRIMARY (
    NAME = N'$(DB_NAME)',
    FILENAME = N'$(DATA_DIR)\$(DB_NAME).mdf',
    SIZE = <%= db_initial_size_kb %>KB,
    MAXSIZE = <%= db_max_size_mb %>MB
) LOG ON (
    NAME = N'$(DB_NAME)_log',
    FILENAME = N'$(DATA_DIR)\$(DB_NAME)_log.ldf',
    SIZE = <%= db_initial_log_size_kb %>KB,
    MAXSIZE = <%= db_max_log_size_mb %>MB
)
GO

ALTER DATABASE [$(DB_NAME)] SET RECOVERY SIMPLE WITH NO_WAIT
ALTER DATABASE [$(DB_NAME)] SET COMPATIBILITY_LEVEL = 100

IF (1 = FULLTEXTSERVICEPROPERTY('IsFullTextInstalled'))
BEGIN
  EXEC [$(DB_NAME)].[dbo].[sp_fulltext_database] @action = 'enable'
END

ALTER DATABASE [$(DB_NAME)] SET ALLOW_SNAPSHOT_ISOLATION OFF 
ALTER DATABASE [$(DB_NAME)] SET ANSI_NULLS ON 
ALTER DATABASE [$(DB_NAME)] SET ANSI_NULL_DEFAULT ON 
ALTER DATABASE [$(DB_NAME)] SET ANSI_PADDING ON 
ALTER DATABASE [$(DB_NAME)] SET ANSI_WARNINGS ON 
ALTER DATABASE [$(DB_NAME)] SET ARITHABORT ON 
ALTER DATABASE [$(DB_NAME)] SET AUTO_CLOSE ON 
ALTER DATABASE [$(DB_NAME)] SET AUTO_CREATE_STATISTICS ON 
ALTER DATABASE [$(DB_NAME)] SET AUTO_SHRINK ON 
ALTER DATABASE [$(DB_NAME)] SET AUTO_UPDATE_STATISTICS ON 
ALTER DATABASE [$(DB_NAME)] SET AUTO_UPDATE_STATISTICS_ASYNC OFF 
ALTER DATABASE [$(DB_NAME)] SET CONCAT_NULL_YIELDS_NULL ON 
ALTER DATABASE [$(DB_NAME)] SET CURSOR_CLOSE_ON_COMMIT OFF 
ALTER DATABASE [$(DB_NAME)] SET CURSOR_DEFAULT LOCAL 
ALTER DATABASE [$(DB_NAME)] SET DATE_CORRELATION_OPTIMIZATION OFF 
ALTER DATABASE [$(DB_NAME)] SET DB_CHAINING OFF 
ALTER DATABASE [$(DB_NAME)] SET DISABLE_BROKER
ALTER DATABASE [$(DB_NAME)] SET HONOR_BROKER_PRIORITY OFF 
ALTER DATABASE [$(DB_NAME)] SET MULTI_USER 
ALTER DATABASE [$(DB_NAME)] SET NUMERIC_ROUNDABORT OFF 
ALTER DATABASE [$(DB_NAME)] SET PAGE_VERIFY CHECKSUM  
ALTER DATABASE [$(DB_NAME)] SET PARAMETERIZATION SIMPLE 
ALTER DATABASE [$(DB_NAME)] SET QUOTED_IDENTIFIER ON 
ALTER DATABASE [$(DB_NAME)] SET READ_COMMITTED_SNAPSHOT OFF 
ALTER DATABASE [$(DB_NAME)] SET READ_WRITE 
ALTER DATABASE [$(DB_NAME)] SET RECOVERY FULL 
ALTER DATABASE [$(DB_NAME)] SET RECURSIVE_TRIGGERS OFF 
ALTER DATABASE [$(DB_NAME)] SET TRUSTWORTHY OFF 
GO
